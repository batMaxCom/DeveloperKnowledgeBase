# Узлы (Nodes) — рабочие машины в кластере Kubernetes.

[Вернуться](./README.md)

Могут быть как физическими так и виртуальными. 
По сути одна нада это сервер.


Основные компоненты Control Plane::
- `kube-apiserver` - фронтенд кластера
- `etcd - `хранилище состояния кластера
- `kube-scheduler`   - планировщик Pods
- `kube-controller manager` - контроллеры
- `cloud-controller manager` - интеграция с облаком

```bash
# Проверить статус компонентов
kubectl get componentstatuses
```
Ноды деляться на два типа:

- `Worker node`
- `Master node` (Control Plane)

## Worker node
`Worker node` - сервер на котором запускается и работает контейнер

Состоит из:
- kubelet - агент, связывающий ноду с кластером
- kube-proxy - сетевой прокси и балансировщик
- Container Runtime - Docker, containerd, CRI-O

`kubelet` - агент, работающий на каждом узле в кластере. Он следит за тем, чтобы контейнеры были запущены в поде.
Его задача — обеспечивать, чтобы контейнеры действительно работали так, как это описано в спецификациях Pod'ов, которые он получает от kube-apiserver.

### kubelet
Ключевые функции kubelet
1. `Управление жизненным циклом Pod'ов`

- Запускает, останавливает и поддерживает контейнеры согласно полученным спецификациям
- Обеспечивает, чтобы контейнеры постоянно находились в желаемом состоянии

2. `Взаимодействие с Container Runtime`

- Работает с container runtime (Docker, containerd, CRI-O) через CRI (Container Runtime Interface)
- Отдает команды на создание, удаление и управление контейнерами

3. `Отчетность о состоянии (Health Reporting)`

Постоянно отправляет отчеты в kube-apiserver о состоянии:

- Ноды (доступна/недоступна, ресурсы и т.д.)
- Pod'ов на этой ноде (Running, Error, Pending и т.д.)

4. `Выполнение probes (проверок)`

- Выполняет liveness, readiness и startup пробы для контейнеров
- Перезапускает контейнеры, которые не проходят liveness пробу
- Управляет готовностью Pod'ов через readiness пробы

5. `Монтирование томов (Volumes)`

- Монтирует различные типы томов (Persistent Volumes, ConfigMaps, Secrets) в контейнеры
- Управляет жизненным циклом томов

6. `Работа с образами контейнеров`

- Скачивает образы контейнеров из registry
- Управляет кэшем образов на ноде

7. `Поддержка статических Pod'ов (Static Pods)`

- Может запускать Pod'ы, описанные в статических манифестах на самой ноде (обычно в /etc/kubernetes/manifests/)
- Это используется для запуска компонентов control plane на master нодах

### kube-poxy

`kube-poxy` - это сетевой прокси, который работает на каждой ноде Kubernetes и отвечает за реализацию концепции Services — предоставление стабильного сетевого доступа к группе динамически меняющихся Pod'ов.



## Master node (Control Plane)
`Master node (Control Plane)` - серврер, с которого идет централизованное управление всеми `worker node-ами`.
Управляет всем кластером, принимая решения о запуске, распределении и состоянии приложений. 
Все команды на исполнения всегда проходят через `Master node`.

Состоит из:
- kube-apiserver - фронтенд API для всех операций
- etcd - key-value хранилище состояния кластера
- kube-scheduler - решает куда размещать Pods
- kube-controller-manager - контроллеры для разных задач

`kube-apiserver` - это компонент, который предоставляет RESTful API-интерфейс для взаимодействия с кластером Kubernetes. 
 Все коммуникации, как внутренние (между компонентами Kubernetes), так и внешние (пользователи, администраторы, инструменты), проходят через него.

`etcd` - это хранилище данных в формате «ключ-значение», которое используется как основное хранилище всех данных кластера Kubernetes.

`kube-scheduler` - Компонент управляющего слоя (control plane), который отслеживает недавно созданные поды без назначенного для них узла и выбирает узел, на котором они должны работать.


`kube-controller-manager` - компонент управляющего слоя, который запускает процессы контроллера.
Эти контроллеры включают:

- Контроллер узла (Node Controller): уведомляет и реагирует на сбои узла.
- Контроллер репликации (Replication Controller): поддерживает правильное количество подов для каждого объекта контроллера репликации в системе.
- Контроллер конечных точек (Endpoints Controller): заполняет объект конечных точек (Endpoints), то есть связывает сервисы (Services) и поды (Pods).
- Контроллеры учетных записей и токенов (Account & Token Controllers): создают стандартные учетные записи и токены доступа API для новых пространств имен.

