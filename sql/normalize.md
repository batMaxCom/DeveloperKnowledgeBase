# Нормализация

Нормализация — это процесс приведения структуры базы в такой вид, чтобы:
- данные не дублировались
- таблицы были логичны и просты
- изменения в БД не ломали данные
- не было аномалий вставки/обновления/удаления

Без нормализации возникают аномалии:
 
Аномалия вставки:
- Нельзя вставить запись, если нет других данных.

Аномалия обновления:
- Изменение одного значения требует правки десятков строк.

Аномалия удаления:
- Удаление записи приводит к потере важных данных.

## 1NF — Первая нормальная форма

Условие:
- Нет повторяющихся групп столбцов
- Нет массивов, списков, вложенных структур
- Каждая ячейка — атомарная (одно значение)

## 2NF — Вторая нормальная форма
Требования:
- Выполнена 1NF
- Нет зависимостей неключевых полей от части составного ключа

## 3NF — Третья нормальная форма
Требования:
- Выполнена 2NF
- Нет транзитивных зависимостей (поле зависит не от ключа, а от другого неключевого поля)

Транзитивная зависимость это когда:

- ключ → поле A → поле B

При этом B не зависит напрямую от ключа, а зависит от A.

То есть:
- A — неключевое поле
- но от него зависит другое неключевое поле B
- тогда нарушена 3NF

## BCNF (Boyce–Codd Normal Form)

Усложнённая версия 3NF.

Каждый детерминант должен быть ключом.

# Денормализация

Иногда правильная нормализованная схема → слишком медленная.: когда она уместна

Денормализация — сознательное добавление дублирования, чтобы ускорить чтение.

Когда нужно:
- Для отчётов (materialized view)
- Для аналитики
- Чтобы избежать JOIN-ов между большими таблицами
- Для кеширования частых значений
- Когда чтение важнее записи (read-heavy)

# Типы связей

### 1 : 1 (один к одному)

Примеры:
users — user_profiles

Используется когда:
- данные редкие
- вынесены в отдельную таблицу (например, паспортные данные)

### 1 : M (один ко многим)
Самый частый тип.

Примеры:
- user → orders
- category → products

### M : N (многие ко многим)

Требует связующей таблицы.

- products ←→ categories

- product_categories:

| product_id | category_id |
|------------|-------------|

# Примеры
### 1NF

| id | 	name | 	phones   |
|----|-------|-----------|
| 1  | 	Anna | 	+1,+2,+3 |

phones — это список → нарушает 1NF.

Правильно:

users

| id | 	name |
|----|-------|
| 1  | 	Anna |

user_phones

| id | 	user_id | 	phone |
|----|----------|--------|
| 1  | 	1       | 	+1    |
| 2  | 	1       | 	+2    |
| 3  | 	1       | 	+3    |

### 2NF

Плохой пример (составной ключ: order_id + product_id):

| order_id | 	product_id | 	product_name |
|----------|-------------|---------------|
| 10       | 	5          | 	Phone        |
| 10       | 	6          | 	Keyboard     |

product_name зависит только от product_id, а не от всей пары (order_id, product_id). → нарушает 2NF.

Правильно:

Разделяем:

- products: product_id, product_name
- order_items: order_id, product_id, qty

# 3NF

Таблица пользователей:

| user_id(PK) | 	city_id	 | city_name |
|-------------|-----------|-----------|
| 1           | 	10	      | London    |
| 2           | 	11	      | Paris     |

Зависимости:
- user_id → city_id (нормально)
- city_id → city_name (нормально У САМОЙ city_id)
- user_id → city_name (транзитивная зависимость!)

Проблема: city_name зависит не от user_id, а от city_id.